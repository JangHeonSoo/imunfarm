---
import type { GetStaticPathsOptions, Page } from 'astro'
import type { CollectionEntry } from 'astro:content'
import BaseLayout from '@/layouts/BaseLayout'
import Pagination from '@/components/Pagination'
import { getPosts, getTags } from '@/utils'
import { sluglify } from '@/utils'

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
	const posts = await getPosts()
	return paginate(posts, { pageSize: 10 })
}

const { page } = Astro.props as { page: Page<CollectionEntry<'blog'>> }
---

<BaseLayout title='모든 포스트'>
	<div class="max-w-6xl mx-auto py-20 px-4">
		<div class="text-center mb-16">
			<h1 class="text-4xl md:text-5xl font-heading font-bold mb-4">모든 포스트</h1>
			<p class="text-lg text-text-muted dark:text-gray-400">
				총 {page.total}개의 포스트
			</p>
		</div>

        <!-- Main Content: Posts Grid (Centered, No Sidebar) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            {page.data.map((post) => (
                <article class="bg-white dark:bg-gray-800 rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 dark:border-gray-700 group flex flex-col h-full" data-lang={post.data.lang || 'ko'}>
                    {post.data.heroImage && (
                        <a href={`/${post.collection}/${post.slug}`} class="block overflow-hidden h-56 relative">
                            <div class="absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors z-10"></div>
                            <img 
                                src={post.data.heroImage} 
                                alt={post.data.title}
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                            />
                        </a>
                    )}
                    <div class="p-6 flex flex-col flex-grow">
                        <div class="flex items-center gap-2 text-xs text-text-muted dark:text-gray-400 mb-3">
                            <time datetime={post.data.pubDate?.toISOString()}>
                                {post.data.pubDate?.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' })}
                            </time>
                            {post.data.category && (
                                <>
                                    <span>•</span>
                                    <span class="text-primary font-bold px-2 py-0.5 bg-primary/10 rounded-full">{post.data.category}</span>
                                </>
                            )}
                        </div>
                        <h2 class="text-2xl font-heading font-bold mb-3 group-hover:text-primary transition-colors leading-tight">
                            <a href={`/${post.collection}/${post.slug}`}>
                                {post.data.title}
                            </a>
                        </h2>
                        {post.data.description && (
                            <p class="text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-4 flex-grow">
                                {post.data.description}
                            </p>
                        )}
                        
                        {post.data.tags && post.data.tags.length > 0 && (
                            <div class="flex flex-wrap gap-2 mt-auto pt-4 border-t border-gray-100 dark:border-gray-700/50">
                                {post.data.tags.slice(0, 3).map(tag => (
                                    <a 
                                        href={`/tags/${sluglify(tag)}`}
                                        class="text-xs px-2.5 py-1 bg-gray-50 dark:bg-gray-700/50 text-gray-500 dark:text-gray-400 rounded-lg hover:bg-primary/10 hover:text-primary transition-all font-medium"
                                    >
                                        #{tag}
                                    </a>
                                ))}
                                {post.data.tags.length > 3 && (
                                    <span class="text-xs px-2 py-1 text-gray-400">
                                        +{post.data.tags.length - 3}
                                    </span>
                                )}
                            </div>
                        )}
                    </div>
                </article>
            ))}
        </div>

        <div class="mt-20">
            <Pagination page={page} />
        </div>
	</div>
</BaseLayout>

