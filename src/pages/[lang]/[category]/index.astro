---
import { getCategorySlug, getCategories, SUPPORTED_LOCALES, DEFAULT_LOCALE, getLocalePrefix } from '@/utils'

export async function getStaticPaths() {
	const categoriesSet = new Set<string>()
	await Promise.all(
		SUPPORTED_LOCALES.map(async (locale) => {
			const cats = await getCategories(locale)
			cats.forEach((c) => categoriesSet.add(c))
		})
	)
	const categories = Array.from(categoriesSet)

	return SUPPORTED_LOCALES.filter(l => l !== DEFAULT_LOCALE).flatMap((locale) => {
		return categories.map((category: string) => ({
			params: {
				lang: locale,
				category: getCategorySlug(category)
			}
		}))
	})
}

const params = Astro.params
const currentLocale = params.lang || DEFAULT_LOCALE
const localePrefix = getLocalePrefix(currentLocale)

// Encode the URL to handle non-ASCII characters if any
return Astro.redirect(encodeURI(`${localePrefix}/${params.category}/1`))
---
