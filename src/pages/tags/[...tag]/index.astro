---
import BaseLayout from '@/layouts/BaseLayout'
import ListPosts from '@/components/ListPosts'
import TitlePage from '@/components/TitlePage'
import { SUPPORTED_LOCALES, getTags, getPostByTag } from '@/utils'

export async function getStaticPaths() {
	const allTagsSet = new Set<string>()
	await Promise.all(
		SUPPORTED_LOCALES.map(async (locale) => {
			const tags = await getTags(locale)
			tags.forEach((t) => allTagsSet.add(t))
		})
	)
	const allTags = Array.from(allTagsSet)

	return allTags.map((tag) => ({
		params: { tag },
		props: { tag }
	}))
}

const { tag } = Astro.props

const posts = await getPostByTag(tag)
---

<BaseLayout title={tag}>
	<TitlePage title={tag} />
	<ListPosts posts={posts} />
</BaseLayout>
